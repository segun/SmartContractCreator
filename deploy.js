const path = require('path');
const fs = require('fs');
const Web3 = require('web3');
const props = require('./config/config');


async function deploy(abiPath, binPath) {    
    const abi = JSON.parse(fs.readFileSync(path.resolve(abiPath), 'utf8'));
    const bin = fs.readFileSync(path.resolve(binPath), 'utf8');
    const web3 = new Web3(props.web3URL);
    const privKey = props.privKey;
    const address = props.address;    

    const contract = new web3.eth.Contract(abi);

    console.log("Attempting to deploy contract");
    const contractTx = contract.deploy({
        data: bin,
        arguments: [],
    });
    console.log("Contract deployed");

    console.log("Attempting to create transaction");
    const createTransaction = await web3.eth.accounts.signTransaction(
        {
            from: address,
            data: contractTx.encodeABI(),
            gas: props.gas,
        },
        privKey
    );
    console.log("Transaction created");

    console.log('Deploying contract....')
    web3.eth.sendSignedTransaction(createTransaction.rawTransaction).on('receipt', console.log);

    //console.log('Contract deployed at address', createReceipt.contractAddress);
    return  'Creating Contract';    
}

async function run() {
    res = await deploy('/Users/aardvocate/src/SmartContractCreator/contracts/assets/output/_classes_AssetManager_sol_AssetManager.abi', '/Users/aardvocate/src/SmartContractCreator/contracts/assets/output/_classes_AssetManager_sol_AssetManager.bin');
    console.log(res);
}

run();

// 0x6D77942a375be5e3e3aDc07faf6c464A4726Eea2
// abi = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"bytes32","name":"name","type":"bytes32"},{"internalType":"bytes32","name":"description","type":"bytes32"},{"internalType":"uint256","name":"totalQuantity","type":"uint256"},{"internalType":"uint256","name":"quantity","type":"uint256"},{"internalType":"uint256","name":"decimal","type":"uint256"},{"internalType":"address","name":"issuer","type":"address"},{"internalType":"address","name":"owner","type":"address"}],"indexed":false,"internalType":"struct AssetManager.Asset","name":"asset","type":"tuple"}],"name":"AssetCreated","type":"event"},{"anonymous":false,"inputs":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"enum AssetManager.OrderType","name":"orderType","type":"uint8"},{"internalType":"address","name":"seller","type":"address"},{"internalType":"address","name":"buyer","type":"address"},{"internalType":"uint256","name":"assetId","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"price","type":"uint256"},{"internalType":"bool","name":"matched","type":"bool"}],"indexed":false,"internalType":"struct AssetManager.Order","name":"order","type":"tuple"}],"name":"OrderBought","type":"event"},{"anonymous":false,"inputs":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"enum AssetManager.OrderType","name":"orderType","type":"uint8"},{"internalType":"address","name":"seller","type":"address"},{"internalType":"address","name":"buyer","type":"address"},{"internalType":"uint256","name":"assetId","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"price","type":"uint256"},{"internalType":"bool","name":"matched","type":"bool"}],"indexed":false,"internalType":"struct AssetManager.Order","name":"order","type":"tuple"}],"name":"OrderPosted","type":"event"},{"anonymous":false,"inputs":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"enum AssetManager.OrderType","name":"orderType","type":"uint8"},{"internalType":"address","name":"seller","type":"address"},{"internalType":"address","name":"buyer","type":"address"},{"internalType":"uint256","name":"assetId","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"price","type":"uint256"},{"internalType":"bool","name":"matched","type":"bool"}],"indexed":false,"internalType":"struct AssetManager.Order","name":"order","type":"tuple"}],"name":"OrderSold","type":"event"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"uint256","name":"assetId","type":"uint256"}],"name":"_getAsset","outputs":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"bytes32","name":"name","type":"bytes32"},{"internalType":"bytes32","name":"description","type":"bytes32"},{"internalType":"uint256","name":"totalQuantity","type":"uint256"},{"internalType":"uint256","name":"quantity","type":"uint256"},{"internalType":"uint256","name":"decimal","type":"uint256"},{"internalType":"address","name":"issuer","type":"address"},{"internalType":"address","name":"owner","type":"address"}],"internalType":"struct AssetManager.Asset","name":"","type":"tuple"}],"stateMutability":"view","type":"function"},{"inputs":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"enum AssetManager.OrderType","name":"orderType","type":"uint8"},{"internalType":"address","name":"seller","type":"address"},{"internalType":"address","name":"buyer","type":"address"},{"internalType":"uint256","name":"assetId","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"price","type":"uint256"},{"internalType":"bool","name":"matched","type":"bool"}],"internalType":"struct AssetManager.Order","name":"matchingOrder","type":"tuple"}],"name":"_matchOrder","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"enum AssetManager.OrderType","name":"orderType","type":"uint8"},{"internalType":"address","name":"seller","type":"address"},{"internalType":"address","name":"buyer","type":"address"},{"internalType":"uint256","name":"assetId","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"price","type":"uint256"},{"internalType":"bool","name":"matched","type":"bool"}],"internalType":"struct AssetManager.Order","name":"buyOrder","type":"tuple"},{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"enum AssetManager.OrderType","name":"orderType","type":"uint8"},{"internalType":"address","name":"seller","type":"address"},{"internalType":"address","name":"buyer","type":"address"},{"internalType":"uint256","name":"assetId","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"price","type":"uint256"},{"internalType":"bool","name":"matched","type":"bool"}],"internalType":"struct AssetManager.Order","name":"sellOrder","type":"tuple"}],"name":"_processOrder","outputs":[{"internalType":"bool","name":"matched","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"assets","outputs":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"bytes32","name":"name","type":"bytes32"},{"internalType":"bytes32","name":"description","type":"bytes32"},{"internalType":"uint256","name":"totalQuantity","type":"uint256"},{"internalType":"uint256","name":"quantity","type":"uint256"},{"internalType":"uint256","name":"decimal","type":"uint256"},{"internalType":"address","name":"issuer","type":"address"},{"internalType":"address","name":"owner","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"bytes32","name":"name","type":"bytes32"},{"internalType":"bytes32","name":"description","type":"bytes32"},{"internalType":"uint256","name":"totalQuantity","type":"uint256"},{"internalType":"uint256","name":"quantity","type":"uint256"},{"internalType":"uint256","name":"decimal","type":"uint256"},{"internalType":"address","name":"issuer","type":"address"},{"internalType":"address","name":"owner","type":"address"}],"internalType":"struct AssetManager.Asset","name":"a","type":"tuple"}],"name":"cloneAsset","outputs":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"bytes32","name":"name","type":"bytes32"},{"internalType":"bytes32","name":"description","type":"bytes32"},{"internalType":"uint256","name":"totalQuantity","type":"uint256"},{"internalType":"uint256","name":"quantity","type":"uint256"},{"internalType":"uint256","name":"decimal","type":"uint256"},{"internalType":"address","name":"issuer","type":"address"},{"internalType":"address","name":"owner","type":"address"}],"internalType":"struct AssetManager.Asset","name":"","type":"tuple"}],"stateMutability":"pure","type":"function"},{"inputs":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"enum AssetManager.OrderType","name":"orderType","type":"uint8"},{"internalType":"address","name":"seller","type":"address"},{"internalType":"address","name":"buyer","type":"address"},{"internalType":"uint256","name":"assetId","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"price","type":"uint256"},{"internalType":"bool","name":"matched","type":"bool"}],"internalType":"struct AssetManager.Order","name":"o","type":"tuple"}],"name":"cloneOrder","outputs":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"enum AssetManager.OrderType","name":"orderType","type":"uint8"},{"internalType":"address","name":"seller","type":"address"},{"internalType":"address","name":"buyer","type":"address"},{"internalType":"uint256","name":"assetId","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"price","type":"uint256"},{"internalType":"bool","name":"matched","type":"bool"}],"internalType":"struct AssetManager.Order","name":"","type":"tuple"}],"stateMutability":"pure","type":"function"},{"inputs":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"bytes32","name":"name","type":"bytes32"},{"internalType":"bytes32","name":"description","type":"bytes32"},{"internalType":"uint256","name":"totalQuantity","type":"uint256"},{"internalType":"uint256","name":"quantity","type":"uint256"},{"internalType":"uint256","name":"decimal","type":"uint256"},{"internalType":"address","name":"issuer","type":"address"},{"internalType":"address","name":"owner","type":"address"}],"internalType":"struct AssetManager.Asset","name":"a","type":"tuple"},{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"bytes32","name":"name","type":"bytes32"},{"internalType":"bytes32","name":"description","type":"bytes32"},{"internalType":"uint256","name":"totalQuantity","type":"uint256"},{"internalType":"uint256","name":"quantity","type":"uint256"},{"internalType":"uint256","name":"decimal","type":"uint256"},{"internalType":"address","name":"issuer","type":"address"},{"internalType":"address","name":"owner","type":"address"}],"internalType":"struct AssetManager.Asset","name":"b","type":"tuple"}],"name":"copyAsset","outputs":[],"stateMutability":"pure","type":"function"},{"inputs":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"enum AssetManager.OrderType","name":"orderType","type":"uint8"},{"internalType":"address","name":"seller","type":"address"},{"internalType":"address","name":"buyer","type":"address"},{"internalType":"uint256","name":"assetId","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"price","type":"uint256"},{"internalType":"bool","name":"matched","type":"bool"}],"internalType":"struct AssetManager.Order","name":"a","type":"tuple"},{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"enum AssetManager.OrderType","name":"orderType","type":"uint8"},{"internalType":"address","name":"seller","type":"address"},{"internalType":"address","name":"buyer","type":"address"},{"internalType":"uint256","name":"assetId","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"price","type":"uint256"},{"internalType":"bool","name":"matched","type":"bool"}],"internalType":"struct AssetManager.Order","name":"b","type":"tuple"}],"name":"copyOrder","outputs":[],"stateMutability":"pure","type":"function"},{"inputs":[{"components":[{"internalType":"bytes32","name":"name","type":"bytes32"},{"internalType":"bytes32","name":"description","type":"bytes32"},{"internalType":"uint256","name":"totalQuantity","type":"uint256"},{"internalType":"uint256","name":"quantity","type":"uint256"},{"internalType":"uint256","name":"decimal","type":"uint256"}],"internalType":"struct AssetManager.AssetRequest","name":"assetRequest","type":"tuple"}],"name":"createAsset","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"getAssets","outputs":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"bytes32","name":"name","type":"bytes32"},{"internalType":"bytes32","name":"description","type":"bytes32"},{"internalType":"uint256","name":"totalQuantity","type":"uint256"},{"internalType":"uint256","name":"quantity","type":"uint256"},{"internalType":"uint256","name":"decimal","type":"uint256"},{"internalType":"address","name":"issuer","type":"address"},{"internalType":"address","name":"owner","type":"address"}],"internalType":"struct AssetManager.Asset[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getBuyOrders","outputs":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"enum AssetManager.OrderType","name":"orderType","type":"uint8"},{"internalType":"address","name":"seller","type":"address"},{"internalType":"address","name":"buyer","type":"address"},{"internalType":"uint256","name":"assetId","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"price","type":"uint256"},{"internalType":"bool","name":"matched","type":"bool"}],"internalType":"struct AssetManager.Order[]","name":"","type":"tuple[]"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getIssuedAssets","outputs":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"bytes32","name":"name","type":"bytes32"},{"internalType":"bytes32","name":"description","type":"bytes32"},{"internalType":"uint256","name":"totalQuantity","type":"uint256"},{"internalType":"uint256","name":"quantity","type":"uint256"},{"internalType":"uint256","name":"decimal","type":"uint256"},{"internalType":"address","name":"issuer","type":"address"},{"internalType":"address","name":"owner","type":"address"}],"internalType":"struct AssetManager.Asset[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getMatchedOrders","outputs":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"enum AssetManager.OrderType","name":"orderType","type":"uint8"},{"internalType":"address","name":"seller","type":"address"},{"internalType":"address","name":"buyer","type":"address"},{"internalType":"uint256","name":"assetId","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"price","type":"uint256"},{"internalType":"bool","name":"matched","type":"bool"}],"internalType":"struct AssetManager.Order[]","name":"","type":"tuple[]"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"getOrders","outputs":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"enum AssetManager.OrderType","name":"orderType","type":"uint8"},{"internalType":"address","name":"seller","type":"address"},{"internalType":"address","name":"buyer","type":"address"},{"internalType":"uint256","name":"assetId","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"price","type":"uint256"},{"internalType":"bool","name":"matched","type":"bool"}],"internalType":"struct AssetManager.Order[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getSellOrders","outputs":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"enum AssetManager.OrderType","name":"orderType","type":"uint8"},{"internalType":"address","name":"seller","type":"address"},{"internalType":"address","name":"buyer","type":"address"},{"internalType":"uint256","name":"assetId","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"price","type":"uint256"},{"internalType":"bool","name":"matched","type":"bool"}],"internalType":"struct AssetManager.Order[]","name":"","type":"tuple[]"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserAssets","outputs":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"bytes32","name":"name","type":"bytes32"},{"internalType":"bytes32","name":"description","type":"bytes32"},{"internalType":"uint256","name":"totalQuantity","type":"uint256"},{"internalType":"uint256","name":"quantity","type":"uint256"},{"internalType":"uint256","name":"decimal","type":"uint256"},{"internalType":"address","name":"issuer","type":"address"},{"internalType":"address","name":"owner","type":"address"}],"internalType":"struct AssetManager.Asset[]","name":"","type":"tuple[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getUserOrders","outputs":[{"components":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"enum AssetManager.OrderType","name":"orderType","type":"uint8"},{"internalType":"address","name":"seller","type":"address"},{"internalType":"address","name":"buyer","type":"address"},{"internalType":"uint256","name":"assetId","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"price","type":"uint256"},{"internalType":"bool","name":"matched","type":"bool"}],"internalType":"struct AssetManager.Order[]","name":"","type":"tuple[]"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"orders","outputs":[{"internalType":"uint256","name":"id","type":"uint256"},{"internalType":"enum AssetManager.OrderType","name":"orderType","type":"uint8"},{"internalType":"address","name":"seller","type":"address"},{"internalType":"address","name":"buyer","type":"address"},{"internalType":"uint256","name":"assetId","type":"uint256"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"price","type":"uint256"},{"internalType":"bool","name":"matched","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"components":[{"internalType":"enum AssetManager.OrderType","name":"orderType","type":"uint8"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"price","type":"uint256"},{"internalType":"uint256","name":"assetId","type":"uint256"}],"internalType":"struct AssetManager.OrderRequest","name":"orderRequest","type":"tuple"}],"name":"postOrder","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"components":[{"internalType":"bytes32","name":"name","type":"bytes32"},{"internalType":"bytes32","name":"description","type":"bytes32"},{"internalType":"uint256","name":"totalQuantity","type":"uint256"},{"internalType":"uint256","name":"quantity","type":"uint256"},{"internalType":"uint256","name":"decimal","type":"uint256"}],"internalType":"struct AssetManager.AssetRequest","name":"asset","type":"tuple"}],"name":"validateAsset","outputs":[],"stateMutability":"pure","type":"function"},{"inputs":[{"components":[{"internalType":"enum AssetManager.OrderType","name":"orderType","type":"uint8"},{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint256","name":"price","type":"uint256"},{"internalType":"uint256","name":"assetId","type":"uint256"}],"internalType":"struct AssetManager.OrderRequest","name":"order","type":"tuple"}],"name":"validateOrder","outputs":[],"stateMutability":"pure","type":"function"}]